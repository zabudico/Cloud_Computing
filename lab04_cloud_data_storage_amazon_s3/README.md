Лабораторная работа №4. Облачное хранилище данных. Amazon S3
Цель работы
Целью работы является познакомиться с сервисом Amazon S3 (Simple Storage Service) и отработать основные операции:

создание публичного и приватного бакетов;
загрузку и организацию объектов;
работу с S3 через AWS CLI (копирование, перемещение, синхронизация);
настройку версионирования и шифрования;
использование S3 Static Website Hosting;
применение Lifecycle-правил для архивирования старых данных.
После выполнения работы студент:

понимает концепцию объектного хранилища и его отличия от блочного и файлового;
умеет создавать и настраивать бакеты в Amazon S3;
владеет навыками загрузки и управления объектами через консоль и CLI;
знает, как настроить статический веб-хостинг на базе S3;
понимает принципы версионирования и жизненного цикла объектов в S3.
Условие
Amazon S3 — это объектное хранилище AWS, предназначенное для хранения файлов любого типа: изображений, резервных копий, документов, логов и т.д. Каждый объект хранится внутри бакета (bucket) и имеет уникальный ключ (key). "Папки" в консоли — это лишь префиксы ключей, а не настоящие директории.

В этой лабораторной вы создадите два бакета:

Публичный бакет - для хранения аватаров пользователей и статического контента;
Приватный бакет - для логов и служебных файлов (с Lifecycle-политикой).
Шаг 1. Подготовка
Регион: eu-central-1 (Frankfurt).

Формат имён бакетов:

Публичный: cc-lab4-pub-kXX
Приватный: cc-lab4-priv-kXX
Локально (на своем компьютере) создайте структуру каталогов и файлов, как показано ниже:

s3-lab/
 ├── public/
 │   ├── avatars/
 │   │   ├── user1.jpg
 │   │   └── user2.jpg
 │   └── content/logo.png
 ├── private/
 │   └── logs/
 │       └── activity.csv
 └── README.md
Данные файлы в дальнейшем будут загружены в соответствующие бакеты.

Шаг 2. Создание бакетов
На данном шаге студент может выбрать один из способов создания бакетов:

использовать ACL (упрощённый, наглядный),
использовать Object Ownership Enforced (современный, безопасный).
Ссылка на данный вариант
Чем отличаются два способа управления доступом к бакетам в S3?

В данном гайде описан первый способ (с использованием ACL).

Перейдите в консоль управления AWS S3 и создайте два бакета с указанными именами.

Публичный бакет:

Имя: cc-lab4-pub-kXX
Region: eu-central-1
Object Ownership: ACLs enabled (Can be configured using ACLs)
Block all public access: снять галочку (разрешить публичность)
Подтвердите предупреждение
Нажмите Create bucket
Что означает опция “Block all public access” и зачем нужна данная настройка?

Аналогично создайте Приватный бакет с именем cc-lab4-priv-kXX, но оставьте все настройки по умолчанию (Block all public access — включен).

Режим ACLs enabled позволяет управлять доступом к каждому объекту отдельно (например, сделать одну картинку публичной, а другую — приватной). Это удобно для лабораторных экспериментов и визуально понятно студентам.

Шаг 3. Загрузка объектов через AWS Management Console
Перейдите в бакет cc-lab4-pub-kXX.
Перейдите в директорию avatars/ и нажмите Upload.
Загрузите файл user1.jpg из локальной папки s3-lab/public/avatars/.
После загрузки в пункте Permissions выберите Grant public-read access.
Завершите загрузку нажав Upload.
Чем отличается ключ (object key) от имени файла?

Шаг 4. Загрузка объектов через AWS CLI
Установите и настройте AWS CLI, если это не сделано ранее.

Выполните команду для загрузку файла user2.jpg в публичный бакет:

aws s3 cp s3-lab/public/avatars/user2.jpg s3://cc-lab4-pub-kXX/avatars/user2.jpg --acl public-read
Загрузите файл logo.png в публичный бакет, в директорию content/, также сделав его публичным.

Загрузите файл activity.csv в приватный бакет, не делая его публичным.

В чём разница между командами aws s3 cp, mv и sync и для чего используется параметр флаг --acl public-read?

Шаг 5. Проверка доступа к объектам
Откройте в браузере URL загруженного публичного объекта:

https://cc-lab4-pub-kXX.s3.eu-central-1.amazonaws.com/avatars/user1.jpg
Вы должны увидеть изображение.

Попробуйте открыть URL загруженного приватного объекта, он должен быть недоступен.

Шаг 6. Версионирование объектов
Включите версионирование для обоих бакетов через вкладку Properties → Bucket Versioning → Enable.

Измените файл logo.png и загрузите его заново, чтобы увидеть создание новой версии.
Посмотрите вкладку Versions, там будут отображаться все версии объекта.
Что произойдёт, если выключить версионирование после его включения?

Шаг 7. Создание Lifecycle-правил для приватного бакета
В приватном бакете зайдите в Management → Lifecycle rules → Create rule.
Имя: logs-archive
Префикс: logs/
Actions:
Transition → Standard-IA через 30 дней
Transition → Glacier Deep Archive через 365 дней
Expiration → удалить через 1825 дней (5 лет)
Сохраните правило: Create rule.
Что такое Storage Class в Amazon S3 и зачем они нужны?

Так вы автоматизируете хранение логов: старые файлы будут автоматически архивироваться.

Шаг 8. Создание статического веб-сайта на базе S3
Создайте бакет cc-lab4-web-kXX для хостинга статического сайта:

Имя: cc-lab4-web-kXX
Region: eu-central-1
Object Ownership: ACLs enabled (Can be configured using ACLs)
Block all public access: снять галочку (разрешить публичность)
Нажмите Create bucket
После создания настройте хостинг:

Перейдите в бакет → вкладка Properties → Static website hosting → Edit -> Enable.

Выберите следующие параметры:

Hosting type: Host a static website.
Index document: index.html.
Проанализируйте веб-сайт, прикрепленный к данной лабораторной работе: веб-сайт

Скопируйте файлы веб-сайта в бакет cc-lab4-web-kXX. Не забудьте сделать файлы публичными!

Откройте URL статического сайта, указанный в настройках S3.

С помощью S3 можно быстро и просто развернуть статический сайт без необходимости использования серверов. Например, если у вас есть React-приложение, его собранные файлы можно загрузить в такой бакет для хостинга.

Несмотря на удобство, для серьёзных проектов рекомендуется использовать специализированные сервисы хостинга (например, AWS Amplify), которые предоставляют дополнительные возможности.

Шаг 9. Дополнительное задание. Загрузка файлов через AWS SDK
Дан небольшой скрипт на PHP, который позволяет загружать файлы в S3 через веб-форму.

Форма для загрузки файла (upload.php)

<!-- index.php -->
<form action="upload.php" method="post" enctype="multipart/form-data">
  Select file to upload:
  <input type="file" name="fileToUpload" id="fileToUpload" />
  <input type="submit" value="Upload File" name="submit" />
</form>
Обработчик загрузки файла (upload.php)

<?php

// upload.php

require 'vendor/autoload.php';

use Aws\S3\S3Client;

define('BUCKET_NAME', 'bucket-name');

$s3 = new S3Client([
    'region'  => 'us-central-1',
]);

// Получение файла из формы
$file = $_FILES['fileToUpload']['tmp_name'];
$filename = $_FILES['fileToUpload']['name'];

// Поместить в "папку" avatars (S3 использует префиксы в ключах)
$destinationKey = 'avatars/' . basename($filename);

// Загрузка файла в S3
try {
    $result = $s3->putObject([
        'Bucket'     => BUCKET_NAME,
        'Key'        => $destinationKey,
        'SourceFile' => $file,
        'ACL'        => 'public-read', // Сделать файл публичным
    ]);

    echo "File uploaded successfully. URL: " . $result['ObjectURL'];
} catch (Aws\Exception\AwsException $e) {
    echo "Error uploading file: " . $e->getMessage();
}
Добавьте следующую функциональность:

При загрузке аватара, поменяйте имя файла на уникальное (например, добавьте временную метку или UUID), чтобы избежать конфликтов имён.
Добавьте базу данных (рекомендуется SQLite) для хранения информации о загруженных файлах (оригинальное имя, новое имя, URL, дата загрузки).
Выведите список всех загруженных файлов на отдельной странице.
Контрольные вопросы
Контрольные вопросы указаны выше в некоторых заданиях. Ответьте на них письменно во время выполнения лабораторной работы.
